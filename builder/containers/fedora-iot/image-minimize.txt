# Drop unused kernel modules
drop /usr/lib/modules/*/kernel/
keep /usr/lib/modules/*/kernel/arch/x86/crypto/curve25519-x86_64.ko.xz
keep /usr/lib/modules/*/kernel/drivers/ata/ata_generic.ko.xz
keep /usr/lib/modules/*/kernel/drivers/ata/pata_acpi.ko.xz
keep /usr/lib/modules/*/kernel/drivers/block/loop.ko.xz
keep /usr/lib/modules/*/kernel/drivers/block/zram/zram.ko.xz
keep /usr/lib/modules/*/kernel/drivers/firmware/qemu_fw_cfg.ko.xz
keep /usr/lib/modules/*/kernel/drivers/gpu/drm/tiny/bochs.ko.xz
keep /usr/lib/modules/*/kernel/drivers/input/joydev.ko.xz
keep /usr/lib/modules/*/kernel/drivers/input/serio/serio_raw.ko.xz
keep /usr/lib/modules/*/kernel/drivers/misc/vmw_vmci/vmw_vmci.ko.xz
keep /usr/lib/modules/*/kernel/drivers/net/net_failover.ko.xz
keep /usr/lib/modules/*/kernel/drivers/net/tun.ko.xz
keep /usr/lib/modules/*/kernel/drivers/net/veth.ko.xz
keep /usr/lib/modules/*/kernel/drivers/net/virtio_net.ko.xz
keep /usr/lib/modules/*/kernel/drivers/net/wireguard/wireguard.ko.xz
keep /usr/lib/modules/*/kernel/drivers/powercap/intel_rapl_common.ko.xz
keep /usr/lib/modules/*/kernel/drivers/powercap/intel_rapl_msr.ko.xz
keep /usr/lib/modules/*/kernel/drivers/virtio/virtio_balloon.ko.xz
keep /usr/lib/modules/*/kernel/fs/binfmt_misc.ko.xz
keep /usr/lib/modules/*/kernel/fs/erofs/erofs.ko.xz
keep /usr/lib/modules/*/kernel/fs/fat/fat.ko.xz
keep /usr/lib/modules/*/kernel/fs/fat/vfat.ko.xz
keep /usr/lib/modules/*/kernel/fs/fuse/fuse.ko.xz
keep /usr/lib/modules/*/kernel/fs/netfs/netfs.ko.xz
keep /usr/lib/modules/*/kernel/fs/overlayfs/overlay.ko.xz
keep /usr/lib/modules/*/kernel/lib/crypto/libcurve25519-generic.ko.xz
keep /usr/lib/modules/*/kernel/lib/lz4/lz4_compress.ko.xz
keep /usr/lib/modules/*/kernel/lib/lz4/lz4hc_compress.ko.xz
keep /usr/lib/modules/*/kernel/net/802/stp.ko.xz
keep /usr/lib/modules/*/kernel/net/bridge/bridge.ko.xz
keep /usr/lib/modules/*/kernel/net/core/failover.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv4/netfilter/nf_defrag_ipv4.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv4/netfilter/nf_reject_ipv4.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv4/netfilter/nft_fib_ipv4.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv4/tcp_bbr.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv4/udp_tunnel.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv6/ip6_udp_tunnel.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv6/netfilter/nf_defrag_ipv6.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv6/netfilter/nf_reject_ipv6.ko.xz
keep /usr/lib/modules/*/kernel/net/ipv6/netfilter/nft_fib_ipv6.ko.xz
keep /usr/lib/modules/*/kernel/net/llc/llc.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nf_conntrack.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nf_nat.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nf_tables.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nfnetlink.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nft_chain_nat.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nft_ct.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nft_fib_inet.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nft_fib.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nft_masq.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nft_nat.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nft_reject_inet.ko.xz
keep /usr/lib/modules/*/kernel/net/netfilter/nft_reject.ko.xz
keep /usr/lib/modules/*/kernel/net/rfkill/rfkill.ko.xz
keep /usr/lib/modules/*/kernel/net/sched/sch_cake.ko.xz
keep /usr/lib/modules/*/kernel/net/vmw_vsock/vmw_vsock_virtio_transport_common.ko.xz
keep /usr/lib/modules/*/kernel/net/vmw_vsock/vmw_vsock_vmci_transport.ko.xz
keep /usr/lib/modules/*/kernel/net/vmw_vsock/vsock_loopback.ko.xz
keep /usr/lib/modules/*/kernel/net/vmw_vsock/vsock.ko.xz
keep /usr/lib/modules/*/kernel/net/wireless/cfg80211.ko.xz
keep /usr/lib/modules/*/kernel/sound/core/snd.ko.xz
keep /usr/lib/modules/*/kernel/sound/soundcore.ko.xz

# Drop unused SELinux modules
drop /etc/selinux/targeted/active/modules/
keep /etc/selinux/targeted/active/modules/100/anaconda
keep /etc/selinux/targeted/active/modules/100/application
keep /etc/selinux/targeted/active/modules/100/auditadm
keep /etc/selinux/targeted/active/modules/100/authlogin
keep /etc/selinux/targeted/active/modules/100/base
keep /etc/selinux/targeted/active/modules/100/bootloader
keep /etc/selinux/targeted/active/modules/100/bootupd
keep /etc/selinux/targeted/active/modules/100/chronyd
keep /etc/selinux/targeted/active/modules/100/clock
keep /etc/selinux/targeted/active/modules/100/dbadm
keep /etc/selinux/targeted/active/modules/100/dbus
keep /etc/selinux/targeted/active/modules/100/dmesg
keep /etc/selinux/targeted/active/modules/100/firewalld
keep /etc/selinux/targeted/active/modules/100/fstools
keep /etc/selinux/targeted/active/modules/100/fwupd
keep /etc/selinux/targeted/active/modules/100/getty
keep /etc/selinux/targeted/active/modules/100/git
keep /etc/selinux/targeted/active/modules/100/gnome
keep /etc/selinux/targeted/active/modules/100/gpg
keep /etc/selinux/targeted/active/modules/100/guest
keep /etc/selinux/targeted/active/modules/100/init
keep /etc/selinux/targeted/active/modules/100/iptables
keep /etc/selinux/targeted/active/modules/100/journalctl
keep /etc/selinux/targeted/active/modules/100/libraries
keep /etc/selinux/targeted/active/modules/100/loadkeys
keep /etc/selinux/targeted/active/modules/100/locallogin
keep /etc/selinux/targeted/active/modules/100/logadm
keep /etc/selinux/targeted/active/modules/100/logging
keep /etc/selinux/targeted/active/modules/100/lvm
keep /etc/selinux/targeted/active/modules/100/mandb
keep /etc/selinux/targeted/active/modules/100/miscfiles
keep /etc/selinux/targeted/active/modules/100/modutils
keep /etc/selinux/targeted/active/modules/100/mount
keep /etc/selinux/targeted/active/modules/100/namespace
keep /etc/selinux/targeted/active/modules/100/netutils
keep /etc/selinux/targeted/active/modules/100/oddjob
keep /etc/selinux/targeted/active/modules/100/policykit
keep /etc/selinux/targeted/active/modules/100/remotelogin
keep /etc/selinux/targeted/active/modules/100/rpm
keep /etc/selinux/targeted/active/modules/100/screen
keep /etc/selinux/targeted/active/modules/100/secadm
keep /etc/selinux/targeted/active/modules/100/selinuxutil
keep /etc/selinux/targeted/active/modules/100/setrans
keep /etc/selinux/targeted/active/modules/100/snapper
keep /etc/selinux/targeted/active/modules/100/ssh
keep /etc/selinux/targeted/active/modules/100/staff
keep /etc/selinux/targeted/active/modules/100/su
keep /etc/selinux/targeted/active/modules/100/sudo
keep /etc/selinux/targeted/active/modules/100/sysadm
keep /etc/selinux/targeted/active/modules/100/sysadm_secadm
keep /etc/selinux/targeted/active/modules/100/sysnetwork
keep /etc/selinux/targeted/active/modules/100/systemd
keep /etc/selinux/targeted/active/modules/100/systemd-homed
keep /etc/selinux/targeted/active/modules/100/udev
keep /etc/selinux/targeted/active/modules/100/unconfined
keep /etc/selinux/targeted/active/modules/100/unlabelednet
keep /etc/selinux/targeted/active/modules/100/unprivuser
keep /etc/selinux/targeted/active/modules/100/userdomain
keep /etc/selinux/targeted/active/modules/100/usermanage
keep /etc/selinux/targeted/active/modules/100/usernetctl
keep /etc/selinux/targeted/active/modules/100/virt
keep /etc/selinux/targeted/active/modules/100/virt_supplementary
keep /etc/selinux/targeted/active/modules/100/vlock
keep /etc/selinux/targeted/active/modules/100/webadm
keep /etc/selinux/targeted/active/modules/200/container
keep /etc/selinux/targeted/active/modules/200/passt
keep /etc/selinux/targeted/active/modules/200/passt-repair
keep /etc/selinux/targeted/active/modules/200/pasta
